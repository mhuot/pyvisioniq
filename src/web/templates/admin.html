<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - PyVisionic</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>PyVisionic Admin</h1>
        <div class="header-controls">
            <nav class="header-nav" aria-label="Admin navigation">
                <a href="/" class="cache-link" aria-label="Back to dashboard">Dashboard</a>
                <a href="/cache/" class="cache-link" aria-label="Cache manager">Cache Manager</a>
            </nav>
            {% if current_user %}
            <div class="auth-controls">
                <span class="auth-user">{{ current_user.name or current_user.email }}</span>
                <a href="/auth/logout" class="auth-btn auth-btn-logout" aria-label="Sign out">Sign Out</a>
            </div>
            {% endif %}
        </div>
    </header>

    <main>
        <section class="admin-section" aria-labelledby="health-heading">
            <h2 id="health-heading">Storage Health</h2>
            <div class="admin-health-grid" id="health-grid" role="list">
                <div class="admin-health-card" role="listitem">
                    <h3>Backend Type</h3>
                    <p class="admin-health-value" id="backend-type">--</p>
                </div>
                <div class="admin-health-card" role="listitem">
                    <h3>Status</h3>
                    <p class="admin-health-value" id="backend-status">
                        <span class="status-text">Loading</span>
                    </p>
                </div>
                <div class="admin-health-card" role="listitem">
                    <h3>Read From</h3>
                    <p class="admin-health-value" id="read-from">--</p>
                </div>
                <div class="admin-health-card" role="listitem">
                    <h3>Auto-Refresh</h3>
                    <p class="admin-health-value" id="refresh-countdown">30s</p>
                </div>
            </div>
        </section>

        <section class="admin-section" aria-labelledby="csv-heading">
            <h2 id="csv-heading">CSV Storage</h2>
            <div class="table-container">
                <table class="admin-table" aria-label="CSV storage statistics">
                    <thead>
                        <tr>
                            <th scope="col">File</th>
                            <th scope="col">Rows</th>
                            <th scope="col">Size</th>
                            <th scope="col">Latest Record</th>
                        </tr>
                    </thead>
                    <tbody id="csv-stats-body">
                        <tr><td colspan="4" class="admin-loading">Loading CSV stats...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="admin-section" aria-labelledby="oracle-heading">
            <h2 id="oracle-heading">Oracle Database</h2>
            <div id="oracle-pool-stats" class="admin-pool-stats" aria-label="Oracle connection pool statistics">
                <p>Loading pool metrics...</p>
            </div>
            <div class="table-container">
                <table class="admin-table" aria-label="Oracle storage statistics">
                    <thead>
                        <tr>
                            <th scope="col">Table</th>
                            <th scope="col">Rows</th>
                            <th scope="col">Latest Record</th>
                        </tr>
                    </thead>
                    <tbody id="oracle-stats-body">
                        <tr><td colspan="3" class="admin-loading">Loading Oracle stats...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="admin-section" aria-labelledby="raw-responses-heading">
            <h2 id="raw-responses-heading">Raw API Responses</h2>
            <div class="table-container">
                <table class="admin-table" aria-label="Raw API responses stored in Oracle">
                    <thead>
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Timestamp</th>
                            <th scope="col">API Last Updated</th>
                            <th scope="col">Cached</th>
                            <th scope="col">Fresh</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="raw-responses-body">
                        <tr><td colspan="6" class="admin-loading">Loading raw responses...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="admin-pagination" id="raw-responses-pagination" role="navigation" aria-label="Raw responses pagination"></div>
            <dialog id="raw-response-dialog" class="admin-dialog" aria-labelledby="dialog-title">
                <div class="admin-dialog-header">
                    <h3 id="dialog-title">Raw API Response</h3>
                    <button class="admin-dialog-close" aria-label="Close dialog" id="close-dialog">&times;</button>
                </div>
                <pre class="admin-json-view" id="raw-response-json"></pre>
            </dialog>
        </section>

        <section class="admin-section" aria-labelledby="consumption-heading">
            <h2 id="consumption-heading">Storage Consumption</h2>
            <div class="admin-health-grid" id="consumption-summary" role="list">
                <div class="admin-health-card" role="listitem">
                    <h3>Total Responses</h3>
                    <p class="admin-health-value" id="consumption-total-rows">--</p>
                </div>
                <div class="admin-health-card" role="listitem">
                    <h3>Table Size</h3>
                    <p class="admin-health-value" id="consumption-size">--</p>
                </div>
                <div class="admin-health-card" role="listitem">
                    <h3>Free Tier Used</h3>
                    <p class="admin-health-value" id="consumption-pct">--</p>
                </div>
                <div class="admin-health-card" role="listitem">
                    <h3>Retention</h3>
                    <p class="admin-health-value" id="consumption-retention">--</p>
                </div>
            </div>
            <div class="admin-chart-container">
                <canvas id="consumption-chart" aria-label="Monthly storage consumption chart" role="img"></canvas>
            </div>
        </section>

        <section class="admin-section" aria-labelledby="sync-heading">
            <h2 id="sync-heading">Sync Comparison</h2>
            <div class="table-container">
                <table class="admin-table" aria-label="CSV vs Oracle sync comparison">
                    <thead>
                        <tr>
                            <th scope="col">Table</th>
                            <th scope="col">CSV Rows</th>
                            <th scope="col">Oracle Rows</th>
                            <th scope="col">Difference</th>
                            <th scope="col">Status</th>
                        </tr>
                    </thead>
                    <tbody id="sync-stats-body">
                        <tr><td colspan="5" class="admin-loading">Loading sync data...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 PyVisionic. Vehicle data visualization for Hyundai/Kia Connect.</p>
    </footer>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>
